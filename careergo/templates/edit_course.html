{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.1/dist/css/bootstrap.min.css" 
    rel="stylesheet" integrity="sha384-4bw+/aepP/YC94hEpVNVgiZdgIC5+VKNBQNGCHeKRQN+PtmoHDEXuppvnDJzQIu9" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.1/dist/js/bootstrap.bundle.min.js" 
    integrity="sha384-HwwvtgBNo3bZJJLYd8oVXjrBZt8cqVSpeBNS5n7C8IVInixGAoxmnlMuBnhbgrkm" crossorigin="anonymous"></script>

    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script src="{% static 'js/main.js' %}"></script>
    <style>
        .error-message{
            color: red;
        }
    </style>
</head>
<body>

{% block content %}
<div class="container mt-4">
    <h1>Edit Course</h1>
    {% comment %} <form method="post" enctype="multipart/form-data" onsubmit="return validateForm();">
        {% csrf_token %}
        <div class="form-group">
            <label class="mt-2 mb-1">Course Title</label>
            <input type="text" name="course_title" class="form-control" value="{{ course.course_title }}" onkeyup="validateFirst_Name(this)"  required>
            <div class="error-message"></div>
            
        </div><br>
        <div class="form-group">

            <label class="mt-2 mb-1">Description</label>
            <textarea class="form-control h-120" name="description" id="description" onkeyup="validateDescription(this)" required>{{ course.description }}</textarea>
            <div class="error-message"></div>
            
        </div><br>
        <div class="form-group">
            <label class="mt-2 mb-1">Duration</label>
            <input type="number" name="duration" class="form-control" id="duration" value="{{ course.duration }}" onkeyup="validateDuration(this)" required>
            <div class="error-message"></div>
            
        </div><br>
        <div class="form-group">
            <label class="mt-2 mb-1">Price</label>
            <input type="number" name="price" id="price" class="form-control" value="{{ course.price }}" onkeyup="validatePrice(this)" placeholder="Rupees">
            <div class="error-message"></div>
            
        </div><br>
        <div class="form-group">
            <label class="mt-2 mb-1">Instructor</label>
            <input type="text" name="instructor"  id="instructor" class="form-control" value="{{ user.username }}" onkeyup="validateFirst_Name(this)">
            <div class="error-message"></div>
        </div><br>

        <div class="form-group">


            <label class="mt-2 mb-1">Category</label>
            <select name="category" id="categorySelect" class="form-control" required>
                <option value="{{ course.category }}">{{ course.get_category_display }}</option>
                {% for category_value, category_label in course.CATEGORY_CHOICES %}
                    <option value="{{ category_value }}">{{ category_label }}</option>
                {% endfor %}
                <option value="other">Other</option> <!-- Add the "Other" option here -->
            </select>
        </div>
        <div class="form-group col-md-6 pd-20" id="otherCategoryInput" style="display: none;">
            <label class="mt-2 mb-1">Other Category</label>
            <input type="text" name="other_category" class="form-control">
        
            
           
        </div><br>
        
        

        <div class="frm_submit_block mb-5">
            <h3 class="mb-3">Gallery</h3>
            <div class="frm_submit_wrap">
                <div class="row">
                    <div class="form-group col-md-3 pd-10">
                        <label class="mt-2 mb-1">Thumbnail Image</label>
                        <input type="file" name="thumbnail" class="form-control"  accept=".jpg, .jpeg, .png" required>
                        <small class="text-muted">Accepted formats: JPG, JPEG, PNG</small>
                    </div>
                    
                        
                        <div class="form-group col-md-3 pd-10 video-input-container">
                            <div class="section-input">
                                <label>Section Name:</label>
                                <input type="text" name="section_name[]" class="form-control" required>
                                <label class="mt-2 mb-1">Course Video:</label>
                                <input type="file" name="videos[]" class="form-control" accept="video/*" multiple required>
                                <small class="text-muted">Accepted formats: video</small><br><br>
                            </div>
                        </div>
                    
                        <button type="button" id="addVideoButton" class="btn btn-primary mt-3">Add More Videos</button>
                                                                       

                </div>
            </div>
        </div>
       <center> <button type="submit" class="btn btn-primary">Update Course</button></center>
    </form> {% endcomment %}




    <form method="POST" enctype="multipart/form-data">
        {% csrf_token %}
        <section class="gray pt-5 pb-5">
            <div class="container-fluid">
    
                <div class="row justify-content-center">
    
                    <div class="col-lg-9 col-md-8">
                        <div class="dashboard-body">
    
                            <div class="dashboard-wraper">
                                <div class="row">
    
                                    <div class="col-lg-12 col-md-12">
                                        <div class="submit-page px-0">
    
                                            <!-- Basic Information -->
                                            <div class="frm_submit_block  mb-5">
                                                <h3>Course Information</h3>
                                                <div class="frm_submit_wrap">
                                                    <div class="row">
    
    
                                                        <div class="form-group col-md-6 pd-20">
                                                            <label class="mt-2 mb-1">Course Title</label>
                                                            <input type="text" name="course_title" value="{{ course.course_title }}" class="form-control" onkeyup="validateFirst_Name(this)" >
                                                            <div class="error-message"></div>
                                                        </div>
                                                
                                                        
                                                        <div class="form-group col-md-12">
                                                            <label class="mt-2 mb-1">Description</label>
                                                            <textarea class="form-control h-120" name="description" id="description" onkeyup="validateDescription(this)" >{{ course.description }}</textarea>
                                                            <div class="error-message"></div>
                                                        </div>
                                                        
                                                        <div class="form-group col-md-6 pd-20">
                                                            <label class="mt-2 mb-1">Duration</label>
                                                            <input type="number" name="duration" class="form-control" id="duration" value="{{ course.duration }}" onkeyup="validateDuration(this)" >
                                                            <div class="error-message"></div>
                                                        </div>
                                                        <div class="form-group col-md-6 pd-20">
                                                            <label class="mt-2 mb-1">Instructor</label>
                                                            <input type="text" name="instructor" value="{{ user.username }}" id="instructor" class="form-control" onkeyup="validateFirst_Name(this)">
                                                            
                                                            <div class="error-message"></div>
                                                        </div>
                                                        <div class="form-group col-md-6 pd-20" id="priceField" >
                                                            <label class="mt-2 mb-1">Price</label>
                                                            <input type="number" name="price" id="price" class="form-control" value="{{ course.price }}" onkeyup="validatePrice(this)" placeholder="Rupees">
                                                            <div class="error-message"></div>
                                                        </div>


                                                        <div class="form-group col-md-6 pd-20">
                                                            <label class="mt-2 mb-1">Category</label>
                                                            <select name="category" id="categorySelect" class="form-control" >
                                                                <option value="{{ course.category }}">{{ course.get_category_display }}</option>
                                                                {% for category_value, category_label in category %}
                                                                    <option value="{{ category_value }}">{{ category_label }}</option>
                                                                {% endfor %}
                                                                <option value="other">Other</option> <!-- Add the "Other" option here -->
                                                            </select>
                                                        </div>
                                                        <div class="form-group col-md-6 pd-20" id="otherCategoryInput" style="display: none;">
                                                            <label class="mt-2 mb-1">Other Category</label>
                                                            <input type="text" name="other_category" class="form-control">
                                                        </div>
                                              
                                                    </div>
                                                </div>
                                            </div>
    
                                            <!-- Gallery -->
                                            <div class="frm_submit_block mb-5">
                                                <h3 class="mb-3">Gallery</h3>
                                                <div class="frm_submit_wrap">
                                                    <div class="row">
                                                        <div class="form-group col-md-3 pd-10">
                                                            <label class="mt-2 mb-1">Thumbnail Image</label>
                                                            <input type="file" name="thumbnail" class="form-control"  accept=".jpg, .jpeg, .png" >
                                                            <small class="text-muted">Accepted formats: JPG, JPEG, PNG</small>
                                                        </div>
                                                        
                                                            
                                                            <div class="form-group col-md-3 pd-10 video-input-container">
                                                                <div class="section-input">
                                                                    <label>Section Name:</label>
                                                                    <input type="text" name="section_name[]" class="form-control" >
                                                                    <label class="mt-2 mb-1">Course Video:</label>
                                                                    <input type="file" name="videos[]" class="form-control" accept="video/*" multiple>
                                                                    <small class="text-muted">Accepted formats: video</small><br><br>
                                                                </div>
                                                            </div>
                                                        
                                                            <button type="button" id="addVideoButton" class="btn btn-primary mt-3">Add More Videos</button>
                                                                                                           
                             
                                                    </div>
                                                </div>
                                            </div>
    
                                          
                                                        
                                                    </div>
                                                </div>
                                            </div>
            
                                            <div class="form-group col-lg-12 col-md-12 text-center">
                                                <button class="btn btn-success" type="submit">Update Course</button>
                                            </div>
    
                                        </div>
                                    </div>
    
                                </div>
    
                            </div>
                            <!-- row -->
    
                        </div>
                    </div>
    
                </div>
            </div>
        </section>
    </form>


</div>
{% endblock %}


<script>


    document.getElementById('thumbnail').addEventListener('change', function() {
        const allowedExtensions = ['.jpg', '.jpeg', '.png'];
        const input = this;

        if (input.files && input.files[0]) {
            const fileName = input.files[0].name;
            const fileExtension = fileName.split('.').pop().toLowerCase();

            if (!allowedExtensions.includes('.' + fileExtension)) {
                alert('Invalid file format. Please select a JPG, JPEG, or PNG file.');
                input.value = ''; // Clear the input field
            }
        }
    });


       

</script>
<script>
    // JavaScript validation functions

    function validateFirst_Name(inputField) {
        const namePattern = /^[A-Za-z ]+/;
        const errorDiv = inputField.nextElementSibling; // Get the next sibling element for displaying errors

        if (!namePattern.test(inputField.value)) {
            inputField.classList.add('is-invalid');
            inputField.classList.remove('is-valid');
            errorDiv.textContent = 'Invalid input. Only alphabets and spaces are allowed.';
            return false;
        } else {
            inputField.classList.remove('is-invalid');
            inputField.classList.add('is-valid');
            errorDiv.textContent = '';
            return true;
        }
    }
    function validateDescription(inputField) {
        const descriptionValue = inputField.value.trim();
        const errorDiv = inputField.nextElementSibling; // Get the next sibling element for displaying errors

        if (descriptionValue === '') {
            inputField.classList.add('is-invalid');
            inputField.classList.remove('is-valid');
            errorDiv.textContent = 'Description is required.';
            return false;
        }

        const words = descriptionValue.split(/\s+/); // Split by spaces
        const wordCount = words.length;

        if (wordCount < 20 || wordCount > 60) {
            inputField.classList.add('is-invalid');
            inputField.classList.remove('is-valid');
            errorDiv.textContent = 'Description should be between 20 and 60 words.';
            return false;
        }

        inputField.classList.remove('is-invalid');
        inputField.classList.add('is-valid');
        errorDiv.textContent = '';
        return true;
    }

    function validateDuration(inputField) {
        const durationValue = inputField.value;
        const errorDiv = inputField.nextElementSibling; // Get the next sibling element for displaying errors

        if (isNaN(durationValue) || durationValue < 1 || durationValue > 12) {
            inputField.classList.add('is-invalid');
            inputField.classList.remove('is-valid');
            errorDiv.textContent = 'Invalid input. Duration should be between 1 and 12 hrs.';
            return false;
        } else {
            inputField.classList.remove('is-invalid');
            inputField.classList.add('is-valid');
            errorDiv.textContent = '';
            return true;
        }
    }

    function validatePrice(inputField) {
        const priceValue = inputField.value;
        const errorDiv = inputField.nextElementSibling; // Get the next sibling element for displaying errors

        const pricePattern = /^\d{1,5}$/; // Allows positive numbers with up to 5 digits

        if (!pricePattern.test(priceValue)) {
            inputField.classList.add('is-invalid');
            inputField.classList.remove('is-valid');
            errorDiv.textContent = 'Invalid input. Please enter a valid price (up to 5 digits).';
            return false;
        } else {
            inputField.classList.remove('is-invalid');
            inputField.classList.add('is-valid');
            errorDiv.textContent = '';
            return true;
        }
    }
</script>
<script>


    $(document).ready(function () {
    const addVideoButton = $('#addVideoButton');
    const videoInputContainer = $('.video-input-container');

    addVideoButton.click(function () {
        const newVideoContainer = $('<div>').addClass('form-group col-md-20 pd-10 video-input-container');
        const sectionInput = $('<div>').addClass('section-input');
        const sectionNameInput = $('<input>').attr({
            type: 'text',
            name: 'section_name[]',
            class: 'form-control',
            required: 'required',
            placeholder: 'Section Name',
        });
        const videoInput = $('<input>').attr({
            type: 'file',
            name: 'videos[]',
            class: 'form-control',
            accept: 'video/*',
            multiple: 'multiple',
            required: 'required',
        });
        const smallText = $('<small>').addClass('text-muted').text('Accepted formats: video');

        sectionInput.append(sectionNameInput);
        sectionInput.append('<label class="mt-2 mb-1">Course Video:</label>');
        sectionInput.append(videoInput);
        sectionInput.append(smallText);

        newVideoContainer.append(sectionInput);
        videoInputContainer.append(newVideoContainer);
    });
});



document.addEventListener('DOMContentLoaded', function () {
    const categorySelect = document.getElementById('categorySelect');
    const otherCategoryField = document.getElementById('otherCategoryInput');

    categorySelect.addEventListener('change', function () {
        if (categorySelect.value === 'other') {
            otherCategoryField.style.display = 'block'; // Show the field when "Other" is selected
        } else {
            otherCategoryField.style.display = 'none'; // Hide the field for other options
        }
    });
});
    
</script>

</body>

</html>